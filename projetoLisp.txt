; CAROLINE NAKAZATO RA: 17164260
; FÁBIO    IROKAWA  RA: 17057720

;;;;;;;;;;;;;;;;;;;;;;;;;GLOSSÁRIO;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
; TUDO DE UMA DISCIPLINA (cadar '((1((2) (3) . 4))))     > (((2) (3).4)) 
; DISCIPLINA     (caar   '((1((2) (3) . 4))))            > 1 
; ALUNOS         (caadar '((1((2) (3) . 4))))            > (2) 
; PRIMEIRO ALUNO (car  (caadar '((1((2 6 7) (3) . 4))))) > 2
; OUTROS ALUNOS  (cdr  (caadar '((1((2 6 7) (3) . 4))))) > (6 7)
; PROFESSORES    (car  (cdadar '((1((2) (3) . 4)))))     > (3) 
; PRIMEIRO PROF  (caar (cdadar '((1((2) (3) . 4)))))     > 3
; OUTROS PROF    (cdar (cdadar '((1((2) (3 5) . 4)))))   > (5)
; CURSO          (cdr  (cdadar '((1((2) (3) . 4)))))     > 4 	

;INSERE UM CURSO EM UMA DISCIPLINA
(DEFUN VINCULAR-DISC-CURSO(DISCIPLINA CURSO BD) 
	(if (eql (caar BD) DISCIPLINA)
		(if (null(cdr (cdadar BD))) ; CURSO VAZIO
			(cons (cons DISCIPLINA 
						(cons (cons (cons (car (caadar BD)) (cdr (caadar BD)) )
						(cons (cons (caar (cdadar BD)) (cdar (cdadar BD))) 
						 CURSO)) nil)) (cdr BD)) ; INSERE UM CURSO 
			(cons (car BD) (cdr BD))             ; JÁ EXISTE CURSO P/ ESTA DISCIPLINA
		)
		(if(null(car BD))
			(cons (cons DISCIPLINA (cons (cons (cons nil nil) 
								 (cons (cons nil nil) CURSO)) 
			nil)) nil) ; DISCIPLINA NÃO EXISTE
			(cons (car BD) (VINCULAR-DISC-CURSO DISCIPLINA CURSO (cdr BD))) ; PEGO A PROXIMA DISCIPLINA
		)
	)
)

; TESTES
; INSERE CURSO SEM DISCIPLINA
;(VINCULAR-DISC-CURSO 'CALCULO 'ENGENHARIA '())
;(VINCULAR-DISC-CURSO 'CALCULO 'ENGENHARIA '((APC ((CAROL) (PATRICIA) ))))

; INSERE CURSO COM A DISCIPLINA, MAS JA EXISTE UM CURSO
;(VINCULAR-DISC-CURSO 'CALCULO 'ENGENHARIA '((CALCULO ((CAROL) (OTAVIO) PROD))))

; INSERE CURSO COM A DISCIPLINA, MAS SEM UM CURSO
;(VINCULAR-DISC-CURSO 'CALCULO 'ENGENHARIA '((CALCULO ((CAROL) (OTAVIO) ))))

; VERIFICA SE UM ELEMENTO EXISTE EM UMA LISTA SIMPLES
(DEFUN existe (l a)
	(if(null(car l))
		nil	            ; SE NÃO EXISTIR MAIS LISTA RETORNA NIL
		(if(eql (car l ) a)
			t 			; SE ELEMENTO FOR IGUAL RETORNA TRUE
			(existe (cdr l) a) ; PEGA O PROXIMO ELEMENTO DA LISTA
		)
	)
)

; TESTE
; (EXISTE '(1 2 3) 1)
; (EXISTE '(1 2 3) 0)

; INSERE UM ALUNO EM UMA DISICIPLINA
(DEFUN insereM (l d a)
	(if (eql (caar l) d)     ; SE FOR A DISCIPLINA
		(if (null(caadar l)) ; VERIFICO SE EXISTEM ALUNOS
			(cons (cons d (cons (cons (cons a nil)
									(cons (cons (caar (cdadar l)) (cdar (cdadar l))) 
									(cdr (cdadar l)))) 
			nil)) (cdr l))             ; NÃO EXISTE NENHUM ALUNO
			(if (existe (caadar  l) a) ; VERIFICO SE O ALUNO QUE DESEJO INCLUIR JÁ EXISTE NA LISTA
				(cons (car l) (cdr l)) ; ALUNO JÁ EXISTE
				(cons (cons d (cons (cons (cons a (cons (car (caadar l)) (cdr (caadar l)) ))
									(cons (cons (caar (cdadar l)) (cdar (cdadar l))) 
									(cdr (cdadar l)))) 
				nil)) (cdr l))         ; EXISTEM OUTROS ALUNOS, MAS NAO AQUELE QUE DESEJO INSERIR
			)
		)
		(if(null(car l))
			(cons (cons d (cons (cons (cons a nil) 
								 (cons (cons nil nil) nil)) 
			nil)) nil) ; DISCIPLINA NÃO EXISTE
			(cons (car l) (insereM (cdr l) d a)) ; PEGO A PROXIMA DISCIPLINA
		)
	)
)

; TESTES
; INSERE ALUNO SEM DISCIPLINA
; (insereM '() 'CALCULO 'CAROL )
; (insereM '((APC ((CAROL) (PATRICIA) ))) 'CALCULO 'CAROL )

; INSERE ALUNO NA DISCIPLINA, MAS JA EXISTE O ALUNO
; (insereM  '((CALCULO ((CAROL) (OTAVIO) COMP))) 'CALCULO 'CAROL )

; INSERE ALUNO COM A DISCIPLINA
; (insereM  '((CALCULO (() (OTAVIO) COMP))) 'CALCULO 'CAROL )
; (insereM  '((CALCULO ((FABIO) (OTAVIO) COMP))) 'CALCULO 'CAROL )
; (insereM  '((APC ((FABIO) (PATRICIA) COMP)) (CALCULO ((FABIO) (OTAVIO) COMP))) 'CALCULO 'CAROL )

; INSERE UM ALUNO EM VARIAS DISCIPLINAS
(DEFUN VINCULAR-DISC-ALUNO (DISCIPLINAS ALUNO BD) 
	(IF(NULL (CAR DISCIPLINAS)) ; VERIFICO SE A LISTA DE DISCIPLINAS ESTÁ VAZIA
		(CONS (car BD) (cdr BD)) 
		(VINCULAR-DISC-ALUNO (CDR DISCIPLINAS) ALUNO 
			(INSEREM BD (CAR DISCIPLINAS) ALUNO )) ; COLOCO UM ALUNO EM UMA DISCIPLINA
	)
)

; TESTE
; (VINCULAR-DISC-ALUNO '(CALCULO APC) 'CAROL '((CALCULO ((FABIO) (OTAVIO) COMP))) )

;INSERE VARIOS ALUNOS EM VARIAS DISCIPLINAS
(DEFUN MATRICULAR (ALUNOS DISCIPLINAS BD)
	(IF(NULL (CAR ALUNOS))
		(CONS (car BD) (cdr BD))
		(MATRICULAR (CDR ALUNOS) DISCIPLINAS
			(VINCULAR-DISC-ALUNO DISCIPLINAS (CAR ALUNOS)  BD)) 
	)
)

; TESTE
; (MATRICULAR '(CAROL FABIO) '(CALCULO APC) '((CALCULO ((FABIO) (OTAVIO) COMP))) )

;INSERE UM PROFESSOR EM UMA DISCIPLINA
(DEFUN insereP (l d p)
	(if (eql (caar l) d) ; SE FOR A DISCIPLINA
		(if (null(caadar l))  ; VEJO SE JA EXISTE ALGUM PROF
			(cons (cons d (cons (cons (cons (car (caadar l)) (cdr (caadar l)))
									(cons (cons p nil) 
									(cdr (cdadar l)))) 
			nil)) (cdr l))             ; NÃO EXISTE NENHUM PROFESSOR
			(if (existe (car (cdadar  l)) p)
				(cons (car l) (cdr l)) ; JA EXISTE O PROFESSOR
				(cons (cons d (cons (cons (cons (car (caadar l)) (cdr (caadar l)))
									(cons (cons p (cons (caar (cdadar l)) (cdar (cdadar l)))) 
									(cdr (cdadar l)))) 
				nil)) (cdr l)) ; EXISTEM OUTROS PROFESSORES, MAS NÃO AQUELE QUE DESEJO INSERIR
			)
		)
		(if(null(car l))
			(cons (cons d (cons (cons (cons nil nil) 
								 (cons (cons p nil) nil)) 
			nil)) nil) ; DISCIPLINA NÃO EXISTE
			(cons (car l) (insereP (cdr l) d p)) ; PEGO A PROXIMA DISCIPLINA
		)
	)
)

; TESTES
; INSERE PROFESSOR SEM DISCIPLINA
; (insereP '() 'CALCULO 'OTAVIO )
; (insereP '((APC ((CAROL) (PATRICIA) ))) 'CALCULO 'OTAVIO )

; INSERE PROFESSOR NA DISCIPLINA, MAS JA EXISTE O PROFESSOR
; (insereP  '((CALCULO ((CAROL) (OTAVIO) COMP))) 'CALCULO 'OTAVIO )

; INSERE PROFESSOR COM A DISCIPLINA
; (insereP  '((CALCULO ((CAROL) () COMP))) 'CALCULO 'OTAVIO )
; (insereP  '((CALCULO ((FABIO) (OTAVIO) COMP))) 'CALCULO 'MAGELA )
; (insereP  '((APC ((FABIO) (PATRICIA) COMP)) (CALCULO ((FABIO) (OTAVIO) COMP))) 'CALCULO 'MAGELA )

;INSERE UM PROFESSOR EM VARIAS DISCIPLINAS
(DEFUN VINCULAR-DISC-PROF (DISCIPLINAS PROF BD) 
	(IF(NULL (CAR DISCIPLINAS))
		(CONS (car BD) (cdr BD))
		(VINCULAR-DISC-PROF (CDR DISCIPLINAS) PROF 
			(INSEREP BD (CAR DISCIPLINAS) PROF )) 
	)
)

; TESTE
; (VINCULAR-DISC-PROF '(CALCULO_A CALCULO_B) 'OTAVIO '((CALCULO_A ((FABIO) (MAGELA) COMP))) )

;INSERE VARIOS PROFESSORES EM VARIAS DISCIPLINAS
(DEFUN VINCULAR (PROFESSORES DISCIPLINAS BD)
	(IF(NULL (CAR PROFESSORES))
		(CONS (car BD) (cdr BD))
		(VINCULAR (CDR PROFESSORES) DISCIPLINAS
			(VINCULAR-DISC-PROF DISCIPLINAS (CAR PROFESSORES)  BD)) 
	)
)

; TESTE
; (VINCULAR '(OTAVIO MAGELA) '(CALCULO FISICA) '((CALCULO ((FABIO) (OTAVIO) COMP))) )

;EXCLUI UM ELEMENTO DE UMA LISTA SIMPLES
(DEFUN EXCLUIR (L E) 
	(IF(NULL (CAR L))
		NIL
		(IF(EQL (CAR L) E) ; SE O ELEMENTO FOR IGUAL 
			(CDR L)  	   ; RETORNO A LISTA SEM O ELEMENTO
			(CONS (CAR L) (EXCLUIR (CDR L) E)) ; SE NÃO PEGO O PROX
		)
	)
)

; TESTE
; (EXCLUIR '(1 2 3) 2)
; (EXCLUIR '(1 2 3) 0)

; EXCLUI UM ALUNO DE UMA DISCIPLINA
(DEFUN EXCLUIRM (L D A)
	(if (eql (caar l) d)      ; SE FOR IGUAL A DISCIPLINA
		(if (null(caadar l))  ; VERIFICO SE EXISTE ALGUM ALUNO
			(cons (car l) (cdr l)) ; NÃO EXISTE NENHUM ALUNO
			(if (existe (caadar  l) a)
				(cons (cons d (cons (cons (EXCLUIR (caadar L) A)
									(cons (cons (caar (cdadar l)) (cdar (cdadar l))) 
									(cdr (cdadar l)))) 
				nil)) (cdr l))  ; EXISTE O ALUNO QUE DESEJO EXCLUIR
				(cons (car l) (cdr l)); EXISTEM OUTROS ALUNOS, MAS AQUELE QUE DESEJO EXCLUIR 
			)
		)
		(if(null(car l))
			(cons (car l) (cdr l)) ; DISCIPLINA NÃO EXISTE
			(cons (car l) (EXCLUIRM (cdr l) d a)) ; PEGO A PRÓXIMA DISCIPLINA
		)
	)
)

; TESTES
; ALUNO NÃO EXISTE NA DISCIPLINA
; (EXCLUIRM '() 'CALCULO 'OTAVIO )
; (EXCLUIRM '((APC ((CAROL) (PATRICIA) ))) 'CALCULO 'CAROL )
; (EXCLUIRM  '((CALCULO ((FABIO) () COMP))) 'CALCULO 'CAROL )

; EXCLUI ALUNO NA DISCIPLINA
; (EXCLUIRM  '((CALCULO ((CAROL) (OTAVIO) COMP))) 'CALCULO 'CAROL )
; (EXCLUIRM  '((CALCULO ((CAROL FABIO) (OTAVIO) COMP))) 'CALCULO 'CAROL )

;EXCLUI UM ALUNO DE VARIAS DISCIPLINAS
(DEFUN EXCLUIR-DISC-ALUNO (DISCIPLINAS ALUNO BD) 
	(IF(NULL (CAR DISCIPLINAS))
		(CONS (car BD) (cdr BD))
		(EXCLUIR-DISC-ALUNO (CDR DISCIPLINAS) ALUNO 
			(EXCLUIRM BD (CAR DISCIPLINAS) ALUNO )) 
	)
)

; TESTE
; (EXCLUIR-DISC-ALUNO '(CALCULO_A CALCULO_B) 'FABIO '((CALCULO_A ((CAROL FABIO) (MAGELA) COMP))) )

;EXCLUI VARIOS ALUNOS DE VARIAS DISCIPLINAS
(DEFUN CANCELAR-MATRICULA (ALUNOS DISCIPLINAS BD)
	(IF(NULL (CAR ALUNOS))
		(CONS (car BD) (cdr BD))
		(CANCELAR-MATRICULA  (CDR ALUNOS) DISCIPLINAS
			(EXCLUIR-DISC-ALUNO DISCIPLINAS (CAR ALUNOS)  BD)) 
	)

)


(DEFUN EXCLUIRP (L D P)
	(if (eql (caar l) d)
		(if (null(car (cdadar  l))) 
			(cons (car l) (cdr l)) ; nao existe nenhum PROFESSORE
			(if (existe (car (cdadar l)) P)
			(cons (cons d (cons (cons (cons (car (caadar l)) (cdr (caadar l)))
									(cons (excluir (car (cdadar l)) p) 
									(cdr (cdadar l)))) 
			nil)) (cdr l))
			(cons (car l) (cdr l)); existem outros alunos, mas nao existe o que eu vou EXCLUIR 
			)
		)
		(if(null(car l))
			(cons (car l) (cdr l)) ; disciplina nao existe
			(cons (car l) (EXCLUIRP (cdr l) d P)) ; se ainda existirem disciplinas pego proxima
		)
	)
)

;TESTES
;QUANDO SÓ EXISTE O ALUNO QUE SERÁ EXCLUIDO
(EXCLUIRM '((1 ((2) (3) . 4))) 1 2)  > ((1 (NIL (3) . 4))) ESTA OK

;QUANDO NÃO TEM NADA CADASTRADO
(EXCLUIRP '() 1 3)
;QUANDO NÃO TEM NENHUM PROFESSOR CADASTRADO
(EXCLUIRP '((1 ((2) () . 4))) 1 3)
;QUANDO SÓ TEM O ELEMENTO QUE SERA EXCLUIDO
(EXCLUIRP '((1 ((2) (3) . 4))) 1 3)
(EXCLUIRP '((1 ((2) (3 5) . 4))) 1 3)
(EXCLUIRP '((0 ((2) (3) . 4))) 1 3)
(EXCLUIRP '((0 ((2) (3) . 4)) (1 ((2) (3) . 4))) 1 3)

(DEFUN EXCLUIR-DISC-PROF (DISCIPLINAS PROF BD) 
	(IF(NULL (CAR DISCIPLINAS))
		(CONS (car BD) (cdr BD))
		(EXCLUIR-DISC-PROF (CDR DISCIPLINAS) PROF 
			(EXCLUIRP BD (CAR DISCIPLINAS) PROF )) 
	)
)
;QUANDO SÓ EXISTE O ALUNO QUE SERÁ EXCLUIDO
(EXCLUIR-DISC-PROF '() 3 `())
(EXCLUIR-DISC-PROF '() 3 '((1 ((2) (3) . 4))))
(EXCLUIR-DISC-PROF '(1) 3 '((1 ((2) (3) . 4))))

(DEFUN REMOVER-VINCULO (PROFESSORES DISCIPLINAS BD)
	(IF(NULL (CAR PROFESSORES))
		(CONS (car BD) (cdr BD))
		(REMOVER-VINCULO (CDR PROFESSORES) DISCIPLINAS
			(EXCLUIR-DISC-PROF DISCIPLINAS (CAR PROFESSORES)  BD)) 
	)
)

;TESTE
(REMOVER-VINCULO `(3 4) `(1 2) `((1 ((2) (3) . 4)) (2 (() (3 4) . 4)))) ;OK


(DEFUN DISC-CURSO? (DISCIPLINA BD) 
	(IF (NULL(CAAR BD))
		NIL
		(IF (EQL (CAAR BD) DISCIPLINA )
			(cdr (cdadar BD))
			(DISC-CURSO? DISCIPLINA (CDR BD))
		)
	)
)
;TESTES
(DISC-CURSO? 1 '())
(DISC-CURSO? 1 '((1((2) (3)))))
(DISC-CURSO? 1 '((1((2) (3) . 4))))
(DISC-CURSO? 1 '((0((2) (3) . 4))))
(DISC-CURSO? 1 '((0((2) (3) . 5)))(1((2) (3) . 4))))


(DEFUN MATRICULADOS? (DISCIPLINA BD)
	(IF (NULL(CAAR BD))
		NIL
		(IF (EQL (CAAR BD) DISCIPLINA )
			(caadar BD)
			(MATRICULADOS? DISCIPLINA (CDR BD))
		)
	)
)
;TESTE
(MATRICULADOS? 1 '((2 ((2) (3) )) (1 ((2 0) (3 8 9) . 4))))


(DEFUN VINCULADOS? (DISCIPLINA BD) 
	(IF (NULL(CAAR BD))
		NIL
		(IF (EQL (CAAR BD) DISCIPLINA )
			(car (cdadar  BD))
			(VINCULADOS? DISCIPLINA (CDR BD))
		)
	)
)

;TESTES
(VINCULADOS? 1 '())
(VINCULADOS? 1 '((1 ((2) (3) . 4))) )

(DEFUN CURSA? (ALUNO BD) 
	(IF(NULL(caadar BD))
		NIL
		(IF(EXISTE (caadar BD) ALUNO)
			(CONS (caar BD) (CURSA? ALUNO (CDR BD)))
			(CURSA? ALUNO (CDR BD))
		)
	)
)

(CURSA? 2 '((1((2) (3) . 4)) (0((5 2 6) (3) . 4))))

(DEFUN MINISTRA? (PROFESSOR BD) 
	(IF(NULL(car (cdadar BD)))
		NIL
		(IF(EXISTE (car (cdadar BD)) PROFESSOR)
			(CONS (caar BD) (MINISTRA? PROFESSOR (CDR BD)))
			(MINISTRA? PROFESSOR (CDR BD))
		)
	)
)

;TESTE
;(insereM '((2 ((2) (3) )) (1 ((2) (3) ))) 1 4)














